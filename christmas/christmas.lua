-- title:   game title
-- author:  game developer, email, etc.
-- desc:    short description
-- site:    website link
-- license: MIT License (change this to your license of choice)
-- version: 0.1
-- script:  lua


-- Input Center
player_x = 24
player_y = 80
player_h = 20
jump = false
jump_force = -2.5
velocity = 0.0
gravity = 0.2
floor = true
under = false
-- Anim Sets
frame_rate = 8
anim_frame = 1
run_anim = {262,264,266,268}
run_framecount = 4
jump_anim = 0
jump_framecount = 0
-- Camera Scroll
scroll_speed = 1.2
map_x = 0
map_sx = 0

function BOOT()
	trace("Boot")
end

function MapScroll(active, direction)
	if active then
		map_sx = map_sx + (scroll_speed * direction)
	end
	if map_sx >= 8.0 then
		map_sx = map_sx - 8.0
		map_x = map_x - 1
	end
	if map_sx <= -8.0 then
		map_sx = map_sx + 8.0
		map_x = map_x + 1
	end
	map(map_x, 0, 32, 17, map_sx - 8, 0, 8, 1, nil)
end

function Animator()
	frame_rate = frame_rate - 1
	if frame_rate == 0 then
		frame_rate = 8
		anim_frame = anim_frame + 1
		if anim_frame > 4 then
			anim_frame = 1 
		end
	end
	spr(run_anim[anim_frame],15,62,0,1,0,0,2,2)
end

function Collision()
	p_map_x = player_x//8 + map_x
	p_map_y = player_y//8
	p_map_h = (player_y - player_h)//8
	y_tile = mget(p_map_x, p_map_y)
	h_tile = mget(p_map_x, p_map_h)
	floor = fget(y_tile, 1)
	under = fget(h_tile, 1)
end

function TIC()

	if btn(0) then player_y=player_y-1 end
	if btn(1) then player_y=player_y+1 end
	if btn(2) then player_x=player_x-1 end
	if btn(3) then player_x=player_x+1 end
	if velocity == 0.0 and btn(4) then
		velocity = jump_force
	end
	
	cls(8)
	MapScroll(true, -1.0)
	Animator()
	Collision()
	-- Player dot for debug
	pix(player_x, player_y, 13)
	pix(player_x, player_y - player_h, 13)
	print("Jump = " .. tostring(jump), 84, 82)
	print("mx: " .. tostring(map_x), 84, 90)
	print("msx: " .. tostring(map_sx), 84, 98)
	print("p2mx: "..tostring(p_map_x).." p2my: "..tostring(p_map_y), 84, 106)
	print("tile: "..tostring(tile), 84, 114)
	print("floor: "..tostring(floor), 84, 122)
	print("under: "..tostring(under), 84, 130)
end


-- <TILES>
-- 000:8888888888888888888888888888888888888888888888888888888888888888
-- 001:8888888888888888888888888888888888888888888ccc8ccccccccccccccccc
-- 002:8888888888888888888888888888888888888888cc88ccc8cccccccccccccccc
-- 003:bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb
-- 004:bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbcbcbbbbbbcbbbbbbcbcbbbbbbbbbbb
-- 005:8888888888888888888888888888888888888888888ccc8ccccccccccccccccc
-- 006:8888888888888888888888888888888888888888cc88ccc8cccccccccccccccc
-- 016:bbbbbbbbbbbcbbbbbbcbbbbbbcbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb
-- 017:cccbbcccbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb
-- 018:bbccccccbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb
-- 019:bbbbbbbbbbbcbbbbbbbbbbbbbcbcbcbbbbbbbbbbbbbcbbbbbbbbbbbbbbbbbbbb
-- 020:bbbbbbbbbbbbbbbbbbbcbcbbbbbbcbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb
-- 021:cccbbbbcbbbbbbbbaaaaaaaa8888888888888888888888888888888888888888
-- 022:ccbbbbccbbbbbbbbaaaaaaaa8888888888888888888888888888888888888888
-- 032:8888888888877888888778888876678887766778776ccc7ccccccccccccccccc
-- 048:8899aabb444000000333000f0022220f0001110fddddffffcccdeeeec5557766
-- </TILES>

-- <SPRITES>
-- 000:00000000000000000cccc000cc0ccccccccc222c0cc2222c0222222c0011111c
-- 001:0000000000000000000cccc0ccccc0ccc222ccccc2222cc0c2222220c1111100
-- 002:0000000000000022000002220000022c0000c00c0000000c0000002200000022
-- 003:000000002c000000ccc000009390000033300000cccc0000cccc00002cc22000
-- 004:0000000000000022000002220000022c0000c00c0000000c0006662200666622
-- 005:000000002c000000ccc000009390000033300000cccc0000cccc00002cc22000
-- 006:000000020000222200002222000c000c0000000c0000000c0006662200666622
-- 007:200000002c000000ccc000009390000033300000cccc0000cccc00002cc22000
-- 008:00000000000000220000c2220000022c0000000c0000000c0006662200666622
-- 009:000000002c000000ccc000009390000033300000cccc0000cccc00002cc22000
-- 010:0000000000000c02000002220000002200000000000000000000066600006666
-- 011:0000000022c000002ccc0000cc390000cc330000ccccc0002cccc00022cc2000
-- 012:0000000000000002000002220000c02200000000000000000000066600006666
-- 013:0000000022c000002ccc0000cc390000cc330000ccccc0002cccc00022cc2000
-- 016:0022222c00cccccc00cccccc0022222c0042222c0024222c0042422c0024242c
-- 017:c2222200cccccc00cccccc00c2222200c2222200c2222200c2222200c2222200
-- 018:00000fff00000ccc00000222000000220000000200000002000000020000000f
-- 019:ffff4000ccc4c0002222200022220000002000000020000000200000f0ff0000
-- 020:06666fff06666ccc00666222000000220000000200000002000000020000000f
-- 021:ffff4000ccc4c0002222200022220000002000000020000000200000f0ff0000
-- 022:06666fff06666ccc00666222000000220000000200000f2200000f0000000000
-- 023:ffff4000ccc4c00022222000222200000020000000020f000000f00000000000
-- 024:06666fff06666ccc0066622200000022000000200000f2200000f00000000000
-- 025:ffff4000ccc4c000222220002222000000200000002000000020000000ff0000
-- 026:0006666f0006666c000066620000000200000000000000000000000000000000
-- 027:fffff000cccc40002222200022222000022000000202000002f000000fff0000
-- 028:0006666f0006666c000066620000000200000000000000f2000000f000000000
-- 029:fffff000cccc4000222220002222000020020000200020f000000f0000000000
-- </SPRITES>

-- <MAP>
-- 002:000000000000000000000000000000000000000000003030000000000000000000000000000000000000000000000000000000303030000000000000000000000000000000000000000000000000000000003030300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 003:000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000000000
-- 004:000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000303030000000000000000000000000000000000000000000000000000000000030300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000000000
-- 005:000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000300000000000000000000000000000000000000000000000000000000000000000300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000000000
-- 006:000000000000000000000000000000000000000000000030000000000000000000000000000050605060506000000000000000303030000000000000000000000000000000000000000000000000000000003030300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000000000
-- 007:000000000000000000000000000000000000000000000000000000000000000000000000000051615161516100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003030300000
-- 009:102010201020102010201020102010201020102010201020102010201020102010201002102010201002102010201002022010201020102010201020102010201020102010201020102010201020102010201020102010201020102010201020102010201020102010201020102010201020102010201020102010201020102010201020102010201020102010201020102010201020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 010:112111211121112111211121112111211121112111211121112111211121112111211121112111211121112111211121112111211121112111211121112111211121112111211121112111211121112111211121112111211121112111211121112111211121112111211121112111211121112111211121112111211121112111211121112111211121112111211121112111211121000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 011:304030303030303030304030303030303030303130303030303030403030304030303030303030304030303030303030303130303030303030403030304030303030303030304030303030303030303130303030303030403030304030303030303030304030303030303030303130303030303030403030304030303030303030304030303030303030303130303030303030403030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 012:304130413141314130303030303030303030303030303030303030303030304130413141314130303030303030303030303030303030303030303030304130413141314130303030303030303030303030303030303030303030304130413141314130303030303030303030303030303030303030303030304130413141314130303030303030303030303030303030303030303030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 013:303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 014:303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 015:303040303030303030303030303140303030303030303030313030303030303040303030303030303030303140303030303030303030313030303030303040303030303030303030303140303030303030303030313030303030303040303030303030303030303140303030303030303030313030303030303040303030303030303030303140303030303030303030313030303030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 016:303030303030303040303030303030303030303030303030303030303030303030303030303040303030303030303030303030303030303030303030303030303030303040303030303030303030303030303030303030303030303030303030303040303030303030303030303030303030303030303030303030303030303040303030303030303030303030303030303030303030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- </MAP>

-- <WAVES>
-- 000:00000000ffffffff00000000ffffffff
-- 001:0123456789abcdeffedcba9876543210
-- 002:0123456789abcdef0123456789abcdef
-- </WAVES>

-- <SFX>
-- 000:000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000304000000000
-- </SFX>

-- <TRACKS>
-- 000:100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- </TRACKS>

-- <FLAGS>
-- 000:00000000000000000000000000000000002020000020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- </FLAGS>

-- <PALETTE>
-- 000:1a1c2c5d275db13e53ef7d57ffcd75a7f07038b76425717929366f3b5dc941a6f673eff7f4f4f494b0c2566c86333c57
-- </PALETTE>


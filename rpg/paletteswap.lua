-- title:   game title
-- author:  game developer, email, etc.
-- desc:    short description
-- site:    website link
-- license: MIT License (change this to your license of choice)
-- version: 0.1
-- script:  lua

palettes={
	[0]=
	{
		0xee,0xee,0xe2,
		0xae,0xaa,0xaa,
		0x6d,0x6d,0x6d,
		0x28,0x28,0x28
	},
	[33]=
	{
		0x50,0x79,0x00,
		0xc2,0xda,0x79,
		0x4c,0xbe,0x00,
		0x00,0xce,0x6d
	}
}

-- What about rewriting the assigned
-- 0,1,2,3 Palette/Code Colors to 
-- Colors outside of their range?

-- Produce tiles in grayscale, and
-- then instead of re-assigning to
-- Actual RGB values, re-assign them
-- to Palette values. Confined to 
-- 12 (16 to start minus 4 grayscale)
-- However that's still a lot of
-- potential expression.

palette_recode={
	[0]={4,5,6,14},
	[1]={3,2,1,0},
	[2]={5,4,1,4},
	[3]={0,5,10,5},
	[4]={15,14,13,12}
}
recode=true

function pset(p)
	for i=0, 11 do
		poke(0x3FC0+i,p[i+1],8)
	end
end

function recolor_tile(sx,sy,p)
	for x=sx, sx+7 do
		for y=sy, sy+7 do
			local pixC = pix(x,y)
			if pixC < 4 then
				pix(x,y,p[pixC+1])
			end
		end
	end
end

function scry_map()
	for x=0, 30 do
		for y=0, 14 do
			trace(x.."|"..y..": "..mget(x,y))
			local tile = mget(x,y)
			if tile < 6 and tile ~= 0 then 
				recolor_tile(x*8,y*8,palette_recode[4])
			end
			if tile >= 6 and tile < 24 then
				recolor_tile(x*8,y*8,palette_recode[3])
			end
			if tile >=24 then
				recolor_tile(x*8,y*8,palette_recode[2])
			end
		end
	end
end

function BOOT()
	trace("BOOT")
	poke4(2 * 0x3ffc, 4)
	cls()
	map()
	for i=0, 240 do
		trace(i..": "..peek4(0x0000 + i))
	end
end

function TIC()
	cls()
	map()
	if btnp(0) then
		if recode then recode = false
		else recode = true end
	end
	if recode then scry_map() end
end

-- <TILES>
-- 000:0000aaaa0000a2aa0000a08d0000a85f000026ea000069ba0000aea80000abaa
-- 001:555dcccc5459855a565baa6b55e9885b59fd86dcd67da5ccdf554dcc47554ccc
-- 002:ccccceee4588cc5ea6aa0cdeffba0cdeff4a0cdcfb6a455c498a0c0c08ea0c0c
-- 003:ecccc55dcc888458caaaaa5aca888a98cacc85eccacc89eccacc8ccccacc8ccc
-- 004:c4dcceee4588ccee6aaa5dee488a1cee4dc91c5cc5495c5c04da455c0cca0c0c
-- 016:0000c7df0000c37c0000cc4f0000ff5f0000ffdf0000f7ff0000c7f30000c7f0
-- 017:cfffccacfebbaaaadbfb4aa95eabaccdfdefdb69fdfc8fb9cfff0af5ecffccec
-- 018:c5ca04dc659a4d5d5a9a1ced9a9a1cedaeaa4c6e8fa8cc6e8a2cceeecccceeee
-- 019:cacccccccaaaaa5acaaac5aacaaaadcccaaaa9aac8888988cc0004ccecccc4ec
-- 020:ccca0455aaaa0cc6c6aa0ce5a6aa0c6ea6aa0cee8588ccee410cceee555ceeee
-- 032:000005af000005af000005af000005af000005af000005af000005af000005af
-- 033:4e0000004e0000004e0000004e0000004e0000004e0000004e0000004e000000
-- </TILES>

-- <MAP>
-- 000:001200120022002200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 003:000000000010200000304000003040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 004:000000000011210000314100003141000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 007:000000000010200000102000003040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 008:000000000011210000112100003141000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 134:200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- </MAP>

-- <WAVES>
-- 000:00000000ffffffff00000000ffffffff
-- 001:0123456789abcdeffedcba9876543210
-- 002:0123456789abcdef0123456789abcdef
-- </WAVES>

-- <SFX>
-- 000:000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000304000000000
-- </SFX>

-- <TRACKS>
-- 000:100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- </TRACKS>

-- <PALETTE>
-- 000:e2e2d6aeaaaa6d6d6d242424ff040000ff040400ffffff0000ffffff00ffba000004b6000000bababa0404bababa00ba
-- </PALETTE>

